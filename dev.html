<!DOCTYPE html>
<!--
Disk Usage Reports
http://diskusagereports.com/
Version: @@SourceVersion

Copyright (c) @@CopyYear AndrÃ© Mekkawi <diskusage@andremekkawi.com>
This source file is subject to the MIT license in the file LICENSE.txt.
The license is also available at http://diskusagereports.com/license.html
-->
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Disk Usage Report</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<link rel="shortcut icon" href="images/favicon.png" type="image/png">

	<!-- build:less app/css/styles.css -->
	<link rel="stylesheet/less" type="text/css" href="app/css/styles.less">
	<!-- endbuild -->

	<!-- build:clear dev CSS -->
	<link rel="stylesheet" type="text/css" href="app/css/styles-dev.css">
	<!-- endbuild -->

	<!-- build:js app/libs-head.js -->
	<script src="vendor/bower/modernizr/modernizr.js"></script>
	<!--<script src="vendor/bower/requirejs/require.js"></script>-->
	<!-- endbuild -->
</head>
<body>

<!--[if lt IE 7]>
<p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
<![endif]-->

<div class="container">

	<div class="du-title navbar-fixed-top">
		<div class="container">
			<h1>Disk Usage Report for: <span>Applications/Utilities from Xcode</span></h1>
		</div>
	</div>

	<div class="row">
		<div class="col-md-2 hidden-xs">
			<ul id="Tree"></ul>
		</div>

		<div class="col-md-10">

			<div class="du-header">
				<h2>MacOS</h2>
				<div class="du-breadcrumb">
					<ol class="breadcrumb">
						<li class="active">
							<span style="cursor: pointer;" data-toggle="dropdown"><span class="caret"></span> MacOS</span>
							<ul class="dropdown-menu" style="max-width: 100%; overflow: hidden;" role="menu" aria-labelledby="dropdownMenu1">
								<li role="presentation" class="dropdown-header">Parent Directories:</li>
								<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Utilities</a></li>
								<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Application Loader.app</a></li>
								<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Contents</a></li>
								<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Library</a></li>
								<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Spotlight</a></li>
								<li role="presentation"><a role="menuitem" tabindex="-1" href="#">MZSpotlight.mdimporter</a></li>
								<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Contents</a></li>
							</ul>
						</li>
						<li><a href="#">Utilities</a></li>
						<li><a href="#">Application Loader.app</a></li>
						<li><a href="#">Contents</a></li>
						<li><a href="#">Library</a></li>
						<li><a href="#">Spotlight</a></li>
						<li><a href="#">MZSpotlight.mdimporter</a></li>
						<li><a href="#">Contents</a></li>
					</ol>
					<div class="du-breadcrumb-fade"></div>
				</div>
			</div>

			<ul class="nav nav-tabs hidden-xs">
				<li class="active"><a href="#">Contents</a></li>
				<li><a href="#">File List</a></li>
				<li><a href="#">Last Modified</a></li>
				<li><a href="#">File Sizes</a></li>
				<li><a href="#">File Types</a></li>
				<li><a href="#">Top 100</a></li>
			</ul>

			<ul class="nav nav-tabs visible-xs">
				<li class="active dropdown">
					<a href="#" style="cursor: pointer;" data-toggle="dropdown">Contents <span class="caret"></span></a>
					<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Contents  <span class="glyphicon glyphicon-ok" style="font-size: 75%; line-height: 18px;"></span></a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">File List</a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Last Modified</a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">File Sizes</a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Top 100</a></li>
					</ul>
				</li>
			</ul>

			<div style="padding: 8px;">
				<table border="0" class="table table-rigid">
					<thead>
					<tr>
						<th class="contents-col1">
							<div class="visible-xs dropdown">
								<a data-toggle="dropdown" class="dropdown-link" href="#">Size<b><i></i></b></a>
								<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
									<li role="presentation" class="dropdown-header">Show:</li>
									<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Disk Size <span class="glyphicon glyphicon-ok" style="font-size: 75%; line-height: 18px;"></span></a></li>
									<li role="presentation"><a role="menuitem" tabindex="-1" href="#">File Count</a></li>
									<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Sub-Dirs Count</a></li>
									<li role="presentation" class="divider"></li>
									<li role="presentation" class="dropdown-header">Sort Order:</li>
									<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Largest to Smallest <span class="glyphicon glyphicon-ok" style="font-size: 75%; line-height: 18px;"></span></a></li>
									<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Smallest to Largest</a></li>
								</ul>
							</div>
							<div class="hidden-sm hidden-xs">
								<a href="#">Size</a>
							</div>
							<div class="visible-sm">
								<a href="#">Size</a>
								/
								<a href="#">Files<b><i></i></b></a>
								/
								<a href="#">Dirs</a>
							</div>
						</th>
						<th class="contents-col2 hidden-sm hidden-xs">
							<div>
								<a href="#">Files<b><i></i></b></a>
							</div>
						</th>
						<th class="contents-col3 hidden-sm hidden-xs">
							<div>
								<a href="#">Sub Dirs</a>
							</div>
						</th>
						<th class="contents-col4">
							<div>
								<a href="#">Name</a>
							</div>
						</th>
					</tr>
					</thead>
					<tbody id="Rows">

					</tbody>
				</table>
			</div>

		</div>
	</div>

</div><!-- /.container -->

<style>
	#Rows .progress {
		margin: 0;
	}
</style>
<script src="vendor/bower/jquery/jquery.min.js"></script>
<script src="vendor/bower/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="vendor/bower/lodash/dist/lodash.underscore.min.js"></script>
<script src="vendor/bower/backbone/backbone-min.js"></script>
<script id="RowsTemplate" type="text/template">
	<tr>
		<td>
			<div class="progress">
				<div class="progress-bar progress-bar-percent-<%-Math.round(sizePer)%>" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%=sizePer%>%;">
					<span class="left"><%-(Math.round(sizePer * 10) / 10).toFixed(1)%>%</span>
					<span class="right"><%-sizeUnit === "bytes" ? size : (Math.round(size * 10) / 10).toFixed(1)%><%-sizeUnit.replace(/^([A-Z]?).*$/, "$1")%></span>
				</div>
			</div>
		</td>
		<td class="hidden-sm hidden-xs">
			<div class="progress">
				<div class="progress-bar progress-bar-percent-<%-Math.round(filesPer)%>" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%=filesPer%>%;">
					<span class="left"><%-(Math.round(filesPer * 10) / 10).toFixed(1)%>%</span>
					<span class="right"><%-files%></span>
				</div>
			</div>
		</td>
		<td class="hidden-sm hidden-xs">
			<div class="progress">
				<div class="progress-bar progress-bar-percent-<%-Math.round(filesPer)%>" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: <%=filesPer%>%;">
					<span class="left"><%-(Math.round(filesPer * 10) / 10).toFixed(1)%>%</span>
					<span class="right"><%-files%></span>
				</div>
			</div>
		</td>
		<td style="overflow: hidden"><% if (filesInDir) { %><a href="#" class="icon-link"><span class="glyphicon glyphicon-file" style="color: #666; left: 2px;"></span><%-name%></a><% } else { %><a href="#" class="icon-link"><span class="glyphicon glyphicon-folder-open"></span><%-name%></a><% } %></td>
	</tr>
</script>
<script src="dev-tree.js"></script>
<script>
	var rows = [ { name: "Application Loader Application Loader Application Loader Application Loader Application Loader Application Loader.app", size: 144.09, sizeUnit: "MB", sizePer: 74.02, files: 986, filesPer: 30.46 },
		{ name: "iSync Plug-in Maker.app", size: 29.77, sizeUnit: "MB", sizePer: 15.29, files: 1518, filesPer: 46.90 },
		{ name: "BluetoothBluetoothBluetoothBluetoothBluetoothBluetoothBluetoothBluetoothBluetoothBluetoothBluetoothBluetoothBluetoothBluetooth", size: 6.33, sizeUnit: "MB", sizePer: 3.25, files: 119, filesPer: 3.67 },
		{ name: "PackageMaker.app", size: 3.84, sizeUnit: "MB", sizePer: 1.97, files: 167, filesPer: 5.16 },
		{ name: "Speech", size: 2.28, sizeUnit: "MB", sizePer: 1.17, files: 74, filesPer: 2.28 },
		{ name: "Syncrospector.app", size: 1.9, sizeUnit: "MB", sizePer: 0.97, files: 72, filesPer: 2.22 },
		{ name: "Accessibility Tools", size: 1.29, sizeUnit: "MB", sizePer: 0.66, files: 31, filesPer: 0.95 },
		{ name: "USB Prober.app", size: 1.21, sizeUnit: "MB", sizePer: 0.61, files: 35, filesPer: 1.08 },
		{ name: "FileMerge.app", size: 1.05, sizeUnit: "MB", sizePer: 0.53, files: 86, filesPer: 2.65 },
		{ name: "Icon Composer.app", size: 879.33, sizeUnit: "KB", sizePer: 0.44, files: 14, filesPer: 0.43 },
		{ name: "IORegistryExplorer.app", size: 655, sizeUnit: "KB", sizePer: 0.32, files: 33, filesPer: 1.01 },
		{ name: "Property List Editor.app", size: 333.75, sizeUnit: "KB", sizePer: 0.16, files: 28, filesPer: 0.86 },
		{ name: "Help Indexer.app", size: 286.55, sizeUnit: "KB", sizePer: 0.14, files: 20, filesPer: 0.61 },
		{ name: "SleepX.app", size: 270, sizeUnit: "KB", sizePer: 0.13, files: 10, filesPer: 0.30 },
		{ name: "MacPython 2.5", size: 161.9, sizeUnit: "KB", sizePer: 0.08, files: 9, filesPer: 0.27 },
		{ name: "Python 2.6", size: 161.9, sizeUnit: "KB", sizePer: 0.08, files: 9, filesPer: 0.27 },
		{ name: "CrashReporterPrefs.app", size: 128.44, sizeUnit: "KB", sizePer: 0.06, files: 10, filesPer: 0.30 },
		{ name: "Built Examples", size: 89.41, sizeUnit: "KB", sizePer: 0.04, files: 12, filesPer: 0.37 },
		{ name: "Files in this directory", filesInDir: true, size: 120, sizeUnit: "bytes", sizePer: 0.00, files: 3, filesPer: 0.09 } ];
	var $rows = $("#Rows"),
		template = _.template($("#RowsTemplate").html()),
		html = "";
	$rows.html(_.reduce(rows, function(acc, row) {
		return acc + template(_.extend({ filesInDir: false }, row));
	}, ""));
	$(".du-header h2").click(function() {
		var dropdown = $(this).parent().find('.dropdown-menu');
		dropdown.dropdown('toggle');
		return false;
	});

	console.log(tree);

	var TreeNodeModel = Backbone.Model.extend({
		constructor: function(attrs, options) {
			if (options && options.id)
				attrs.id = options.id;

			Backbone.Model.apply(this, arguments);
		},
		initialize: function(attrs, options) {
			_.extend(this, _.pick(options, ['lookup']));
		},
		getChildren: function() {
			if (this._children)
				return this._children;

			return this._children = _.map(this.get('subdirs'), function(hash) {
				return new TreeNodeModel(
					this.lookup[hash],
					{ id: hash, lookup: this.lookup }
				);
			}, this);
		},
		getView: function() {
			if (this._view)
				return this._view;

			return this._view = new TreeNodeView({
				model: this
			});
		}
	});

	var TreeList = Backbone.View.extend({
		className: 'tree-list',
		tagName: 'ul',
		template: _.template('<% _.each(nodeList, function(node, id) {  }); %>'),
		initialize: function(options) {
			_.extend(this, _.pick(options, [ 'nodeList', 'parentNode' ]));
		},
		render: function() {
			this.$el.html(this.template({
				nodeList: this.nodeList,
				parentNode: this.parentNode
			}));
			return this;
		}
	});

	var TreeNodeView = Backbone.View.extend({
		events: {
			'click > span': 'toggle'
		},
		className: 'tree-node',
		tagName: 'li',
		template: _.template("<span><%-model.get('name')%></span><% if (subdirs && subdirs.length) { %><ul></ul><% } %>"),
		render: function() {
			if (this.hasRendered)
				return;

			var model = this.model;
			this.$el.html(this.template({
				view: this,
				model: model,
				subdirs: model.get('subdirs')
			}));

			this.ul = this.$el.find('ul').css('display', 'none');
			this.isExpanded = false;

			this.hasRendered = true;
			return this;
		},
		toggle: function() {
			var ul = this.ul;
			if (ul.size()) {
				if (this.isExpanded) {
					this.contract();
				}
				else {
					this.expand();
				}
			}
		},
		contract: function() {
			if (!this.isExpanded)
				return;

			this.ul.css('display', 'none');
			_.each(this.children || [], function(child) {
				child.contract();
			});

			this.isExpanded = false;
		},
		expand: function() {
			if (this.isExpanded)
				return;

			var ul = this.ul;
			if (!ul.size())
				return;

			if (!this.children) {
				var collection = this.model.collection,
					subdirs = _.map(this.model.get('subdirs') || [], function(id) {
						return collection.get(id);
					}, this);

				if (subdirs.length) {
					this.children = _.map(subdirs, function(child) {
						var view = child.getView();
						ul.append(view.$el);
						view.render();
						return view;
					});
				}
			}

			ul.css('display', '');
			this.isExpanded = true;
		}
	});

	var treeModels = new (Backbone.Collection.extend({
		lookup: tree,
		get: function(id) {
			var item = Backbone.Collection.prototype.get.apply(this, arguments);
			if (!item && this.lookup[id]) {
				item = new TreeNodeModel(
					this.lookup[id],
					{ id: id }
				);
				this.add(item);
			}
			return item;
		}
	}))();

	var rootModel = treeModels.get('d41d8cd98f00b204e9800998ecf8427e');
	if (rootModel) {
		var rootView = rootModel.getView();
		rootView.$el.appendTo('#Tree');
		rootView.render();
	}
</script>

</body>
</html>

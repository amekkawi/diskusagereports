<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Disk Usage Reporting</title>

<script type="text/javascript">
	// Path to the directory that contains the reports.
	// Example: document.reportsBaseURL = '/path/to/me/';
	document.reportsBaseURL = '/php/diskusage-data/';
</script>

<link href="css/jquery.ui.tree.css" type="text/css" rel="stylesheet" />
<link href="css/layout.css" type="text/css" rel="stylesheet" />

<!-- External Scripts -->
<script type="text/javascript" src="js/external/jquery.min.js"></script>
<script type="text/javascript" src="js/external/jquery.ui.core.js"></script>
<script type="text/javascript" src="js/external/jquery.ui.widget.js"></script>
<script type="text/javascript" src="js/external/jquery.ui.mouse.js"></script>
<script type="text/javascript" src="js/external/jquery.ui.position.js"></script>
<script type="text/javascript" src="js/external/jquery.sortelements.js"></script>
<script type="text/javascript" src="js/external/jquery.json.js"></script>
<script type="text/javascript" src="js/external/rsh.js"></script>

<!-- Disk Usage Reporting Scripts -->
<script type="text/javascript" src="js/general.js"></script>
<script type="text/javascript" src="js/jquery.ui.tree.js"></script>
<script type="text/javascript" src="js/viewer.js"></script>

<style type="text/css">
	tbody th {
		text-align: right;
	}
</style>

<!-- Disk Usage Reporting Scripts -->
<script type="text/javascript">
	
	// Override the JSON methods in RSH.
	window.dhtmlHistory.create({
		toJSON: function(o) {
			return $.toJSON(o);
		},
		fromJSON: function(s) {
			return $.evalJSON(s);
		}
	});
	
	// Initialize RSH once the page loads.
	window.onload = function() {
		dhtmlHistory.initialize();
		dhtmlHistory.addListener(function(newLocation, historyData) {
			$(document).trigger('dhtmlhistory', [ newLocation, historyData ]);
		});
	};
	
	// Set up history handling.
	$(document).bind('dhtmlhistory', function(e, location, data) {
		if (document.viewer) document.viewer.display(location);
	});
	
	$(function() {
		// Load the settings file.
		$.ajax({
			cache: false,
			url: document.reportsBaseURL + window.location.search.substring(1) + '/settings',
			type: 'GET',
			dataType: 'json',
			error: function(xhr, status, err){
				alert('Failed to get settings: ' + status);
			},
			success: function(settings, status, xhr){
				
				$('#Title > span').append(' for: ').append($('<b>').text(settings.name));
				$('#Created').text('Created: ' + settings.created).show();
				
				// Load the directory lookup file.
				$.ajax({
					cache: false,
					url: document.reportsBaseURL + window.location.search.substring(1) + '/directories',
					type: 'GET',
					dataType: 'json',
					error: function(xhr, status, err){
						alert('Failed to get directory lookup: ' + status);
					},
					success: function(dirLookup, status, xhr){
						
						document.viewer = new Viewer({
							directories: dirLookup,
							settings: settings,
							report: window.location.search.substring(1)
						});
						
						document.viewer.display(dhtmlHistory.getCurrentLocation(), function(){
							$('#Loading').hide();
							$('#Container').show();
							
							// Force a resize since the viewer is now displayed.
							document.resizeWindow();
						});
					}
				});
			}
		});
	
		// Load the location on first load.
		if (dhtmlHistory.isFirstLoad()) {
			
		}
		
		document.resizeWindow = function() {
			// Set the correct height for the container.
			var containerHeightDiff = $('#Container').outerHeight(true) - $('#Container').height();
			$('#Container').height($('body').height() - containerHeightDiff - $('#Container').offset().top - 10);
			
			var reportHeightDiff = $('#Report').outerHeight(true) - $('#Report').height();
			$('#Report').height($('#RightColumn').height() - reportHeightDiff - $('#Report').position().top);
		};
		
		$(window).bind("resize", function() {
			if (document.resizeTimerID) clearTimeout(document.resizeTimerID);
			document.resizeTimerID = setTimeout(function() {
				document.resizeWindow();
			}, 100);
		});
	});
</script>
</head>
<body>
	
<div id="Title">Disk Usage Report <span></span><div id="Created" style="display: none;"></div>
</div>

<div id="Loading">Loading...</div>

<div id="Container" style="display: none;">

	<div id="LeftColumn">
		<div id="DirectoryTree"></div>
	</div>
	
	<div id="RightColumn">
		
		<div id="ReportHead">
			<div id="Path"></div>
			<div id="DirSummary">Size: <span id="Bytes"></span> (<span id="TotalBytes"></span> incl. sub directories)<br/>
				Files: <span id="Num"></span> (<span id="TotalNum"></span> incl. sub directories)</div>
		</div>
		
		<div id="Tabs">
			<ul>
				<li id="Tab_SubDirs">Contents</li>
				<li id="Tab_Files">File List</li>
				<li id="Tab_Modified">Last Modified</li>
				<li id="Tab_Sizes">File Sizes</li>
				<li id="Tab_Types">File Types</li>
			</ul>
		</div>
		
		<div id="Report">
	
			<div id="Sections">
			
				<div id="Section_SubDirs">
					<table class="styledtable" id="SubDirs" border="1" cellspacing="0" cellpadding="4">
						<thead>
							<tr>
								<th class="totals-sortby-label"><span>Name</span></th>
								<th class="totals-sortby-byte" colspan="3"><span>Total Size</span></th>
								<th class="totals-sortby-num" colspan="3"><span>File Count</span></th>
							</tr>
						</thead>
						<tfoot>
							<td>Total</td>
							<td colspan="3"></td>
							<td colspan="3"></td>
						</tfoot>
						<tbody>
							
						</tbody>
					</table>
				</div>
				
				<div id="Section_Modified">
					<table class="styledtable" id="Modified" border="1" cellspacing="0" cellpadding="4">
						<thead>
							<tr>
								<th class="totals-sortby-label"><span>Age</span></th>
								<th class="totals-sortby-byte" colspan="3"><span>Total Size</span></th>
								<th class="totals-sortby-num" colspan="3"><span>File Count</span></th>
							</tr>
						</thead>
						<tfoot>
							<td>Total</td>
							<td colspan="3"></td>
							<td colspan="3"></td>
						</tfoot>
						<tbody>
							
						</tbody>
					</table>
				</div>
				
				<div id="Section_Sizes">
					<table class="styledtable" id="Sizes" border="1" cellspacing="0" cellpadding="4">
						<thead>
							<tr>
								<th class="totals-sortby-label"><span>Range</span></th>
								<th class="totals-sortby-byte" colspan="3"><span>Total Size</span></th>
								<th class="totals-sortby-num" colspan="3"><span>File Count</span></th>
							</tr>
						</thead>
						<tfoot>
							<td>Total</td>
							<td colspan="3"></td>
							<td colspan="3"></td>
						</tfoot>
						<tbody>
							
						</tbody>
					</table>
				</div>
				
				<div id="Section_Types">
					<table class="styledtable" id="Types" border="1" cellspacing="0" cellpadding="4">
						<thead>
							<tr>
								<th class="totals-sortby-label"><span>Extension</span></th>
								<th class="totals-sortby-byte" colspan="3"><span>Total Size</span></th>
								<th class="totals-sortby-num" colspan="3"><span>File Count</span></th>
							</tr>
						</thead>
						<tfoot>
							<td>Total</td>
							<td colspan="3"></td>
							<td colspan="3"></td>
						</tfoot>
						<tbody>
							
						</tbody>
					</table>
				</div>
				
				<div id="Section_Files">
					<table class="styledtable" id="Files" border="1" cellspacing="0" cellpadding="4">
						<thead>
							<tr>
								<th>Name</th>
								<th>Type</th>
								<th>Size</th>
								<th>Modified</th>
							</tr>
						</thead>
						<tbody>
							
						</tbody>
					</table>
				</div>
				
				<div id="Section_Message" style="display: none;"></div>
			
			</div>
		
		</div> <!-- Report -->
	
	</div> <!-- Right Column -->

</div> <!-- Container -->

</body>
</html>
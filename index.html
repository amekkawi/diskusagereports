<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Disk Usage Reporting</title>

<!-- External Scripts -->
<script type="text/javascript" src="js/external/jquery.min.js"></script>
<script type="text/javascript" src="js/external/jquery.ui.core.js"></script>
<script type="text/javascript" src="js/external/jquery.ui.widget.js"></script>
<script type="text/javascript" src="js/external/jquery.ui.mouse.js"></script>
<script type="text/javascript" src="js/external/jquery.ui.position.js"></script>
<script type="text/javascript" src="js/external/jquery.sortelements.js"></script>
<script type="text/javascript" src="js/general.js"></script>

<style type="text/css">
	tbody th {
		text-align: right;
	}
</style>

<!-- Disk Usage Reporting Scripts -->
<script type="text/javascript">
	var reportHash = '';
	var dirHash = '';
	var dataBaseURL = '/php/diskusage-data/' /*+ reportHash + '/'*/;
	
	var sizesSortCol = 4;
	var sizesSortRev = true;
	
	var sizeGroups = [
		'1 GB or More',
		'500 MB - 1 GB',
		'250 MB - 500 MB',
		'125 MB - 250 MB',
		'75 MB - 125 MB',
		'25 MB - 75 MB',
		'10 MB - 25 MB',
		'5 MB - 10 MB',
		'1 MB - 5 MB',
		'500 KB - 1 MB',
		'250 KB - 500 KB',
		'100 KB - 250 KB',
		'50 KB - 100 KB',
		'25 KB - 50 KB',
		'10 KB - 25 KB',
		'5 KB - 10 KB',
		'1 KB - 5 KB',
		'Less than 1 KB'
	];
	
	var modifiedGroups = [
		'10 Years or More',
		'5 - 10 Years',
		'2 - 5 Years',
		'1 - 2 Years',
		'270 - 365 Days',
		'180 - 270 Days',
		'90 - 180 Days',
		'60 - 90 Days',
		'30 - 60 Days',
		'15 - 30 Days',
		'7 - 15 Days',
		'1 - 7 Days',
		'Today',
		'Future'
	];
	
	$(function(){
		
		var filesBody = $('#Files tbody');
		var typesBody = $('#Types tbody');
		var sizesBody = $('#Sizes tbody');
		var modifiedBody = $('#Modified tbody');
		var subdirsBody = $('#SubDirs tbody');
		var currentData = null;
		
		var sorter = function(tbody, column, direction) {
			$('> tr', tbody).sortElements(function(a, b){
				var a = $('td:eq(' + column + ')', a);
				var b = $('td:eq(' + column + ')', b);
				
				var aVal = a.data('sortvalue') != null ? a.data('sortvalue') : a.text();
				var bVal = b.data('sortvalue') != null ? b.data('sortvalue') : b.text();
				
				return (aVal > bVal ? 1 : -1) * (direction ? 1 : -1);
			});
		};
		
		var updateOverview = function() {
			$('#Path').text(currentData.path);
			$('#Bytes').text(FormatBytes(currentData.bytes) + ' (' + AddCommas(currentData.bytes) + ')');
			$('#TotalBytes').text(FormatBytes(currentData.totalbytes) + ' (' + AddCommas(currentData.totalbytes) + ')');
			$('#Num').text(AddCommas(currentData.num));
			$('#TotalNum').text(AddCommas(currentData.totalnum));
		};
		
		$.ajax({
			async: false,
			cache: false,
			url: dataBaseURL + 'settings',
			type: 'GET',
			dataType: 'json',
			error: function(xhr, status, err) {
				alert('Failed to get settings: ' + status);
			},
			success: function(settings, status, xhr) {
				$.ajax({
					aynsc: false,
					cache: false,
					url: dataBaseURL + settings.root,
					type: 'GET',
					dataType: 'json',
					success: function(data, status, xhr) {
						
						currentData = data;
						
						$('#Path').text(data.path);
						$('#Bytes').text(FormatBytes(data.bytes) + ' (' + AddCommas(data.bytes) + ')');
						$('#TotalBytes').text(FormatBytes(data.totalbytes) + ' (' + AddCommas(data.totalbytes) + ')');
						$('#Num').text(AddCommas(data.num));
						$('#TotalNum').text(AddCommas(data.totalnum));
						
						filesBody.empty();
						for (var i = 0; i < data.files.length; i++) {
							
							var extData = '', ext = data.files[i].name.split('.');
							if (ext.length > 1) ext = (extData = ext[ext.length-1]).htmlencode();
							else ext = "<i>None</i>";
							
							$('<tr>')
								.append($('<td>').text(data.files[i].name))
								.append($('<td>').html(ext).data('sortvalue', extData).css('text-align', 'center'))
								.append($('<td>').text(FormatBytes(data.files[i].size)).data('sortvalue', parseInt(data.files[i].size)).css('text-align', 'right'))
								.append($('<td>').text(data.files[i].date + ' ' + data.files[i].time))
								.appendTo(filesBody);
						}
						
						subdirsBody.empty();
						var subdirsTotals = { 'totalbytes': 0, 'totalnum': 0 };
						for (var i in data.subdirs) {
							subdirsTotals['totalbytes'] += parseInt(data.subdirs[i]['totalbytes']);
							subdirsTotals['totalnum'] += parseInt(data.subdirs[i]['totalnum']);
							
							$('<tr>')
								.append($('<td>').append($('<a>').attr('href', '#' + data.subdirs[i]['hash']).text(data.subdirs[i]['name'])).data('sortvalue', data.subdirs[i]['name']))
								
								.append($('<td>').text(FormatBytes(data.subdirs[i]['totalbytes'])).data('sortvalue', parseInt(data.subdirs[i]['totalbytes'])).css('text-align', 'right'))
								.append($('<td>').text((100 * parseInt(data.subdirs[i]['totalbytes']) / parseInt(data.totalbytes)).toFixed(2) + '%').css('text-align', 'right'))
								.append($('<td>').css('width', '100px').append($('<div>&nbsp;</div>').css({ 'overflow': 'hidden', 'width': (100 * parseInt(data.subdirs[i]['totalbytes']) / parseInt(data.totalbytes)) + '%', 'background-color': '#00CCFF' })))
								
								.append($('<td>').text(data.subdirs[i]['totalnum']).data('sortvalue', parseInt(data.subdirs[i]['totalnum'])).css('text-align', 'right'))
								.append($('<td>').text((100 * parseInt(data.subdirs[i]['totalnum']) / parseInt(data.totalnum)).toFixed(2) + '%').css('text-align', 'right'))
								.append($('<td>').css('width', '100px').append($('<div>&nbsp;</div>').css({ 'overflow': 'hidden', 'width': (100 * parseInt(data.subdirs[i]['totalnum']) / parseInt(data.totalnum)) + '%', 'background-color': '#00CCFF' })))
								
								.appendTo(subdirsBody);
						}
						$('#SubDirs tfoot td:eq(1)').text(FormatBytes(subdirsTotals['totalbytes']) + ' (' + AddCommas(subdirsTotals['totalbytes']) + ')');
						$('#SubDirs tfoot td:eq(2)').text(AddCommas(subdirsTotals['totalnum']));
						
						modifiedBody.empty();
						var modifiedTotals = [0,0];
						for (var age in data.modified) {
							modifiedTotals[0] += parseInt(data.modified[age][0]);
							modifiedTotals[1] += parseInt(data.modified[age][1]);
							
							$('<tr>')
								.append($('<td>').text(modifiedGroups[parseInt(age)]).data('sortvalue', parseInt(age)))
								
								.append($('<td>').text(FormatBytes(data.modified[age][0])).data('sortvalue', parseInt(data.modified[age][0])).css('text-align', 'right'))
								.append($('<td>').text((100 * parseInt(data.modified[age][0]) / parseInt(data.totalbytes)).toFixed(2) + '%').css('text-align', 'right'))
								.append($('<td>').css('width', '100px').append($('<div>&nbsp;</div>').css({ 'overflow': 'hidden', 'width': (100 * parseInt(data.modified[age][0]) / parseInt(data.totalbytes)) + '%', 'background-color': '#00CCFF' })))
								
								.append($('<td>').text(data.modified[age][1]).data('sortvalue', parseInt(data.modified[age][1])).css('text-align', 'right'))
								.append($('<td>').text((100 * parseInt(data.modified[age][1]) / parseInt(data.totalnum)).toFixed(2) + '%').css('text-align', 'right'))
								.append($('<td>').css('width', '100px').append($('<div>&nbsp;</div>').css({ 'overflow': 'hidden', 'width': (100 * parseInt(data.modified[age][1]) / parseInt(data.totalnum)) + '%', 'background-color': '#00CCFF' })))
								
								.appendTo(modifiedBody);
						}
						$('#Modified tfoot td:eq(1)').text(FormatBytes(modifiedTotals[0]) + ' (' + AddCommas(modifiedTotals[0]) + ')');
						$('#Modified tfoot td:eq(2)').text(AddCommas(modifiedTotals[1]));
						
						typesBody.empty();
						var typesTotals = [0,0];
						for (var type in data.types) {
							typesTotals[0] += parseInt(data.types[type][0]);
							typesTotals[1] += parseInt(data.types[type][1]);
							
							$('<tr>')
								.append($('<td>').html(type == '' ? '<i>None</i>' : type.htmlencode()).data('sortvalue', type))
								
								.append($('<td>').text(FormatBytes(data.types[type][0])).data('sortvalue', parseInt(data.types[type][0])).css('text-align', 'right'))
								.append($('<td>').text((100 * parseInt(data.types[type][0]) / parseInt(data.totalbytes)).toFixed(2) + '%').css('text-align', 'right'))
								.append($('<td>').css('width', '100px').append($('<div>&nbsp;</div>').css({ 'overflow': 'hidden', 'width': (100 * parseInt(data.types[type][0]) / parseInt(data.totalbytes)) + '%', 'background-color': '#00CCFF' })))
								
								.append($('<td>').text(data.types[type][1]).data('sortvalue', parseInt(data.types[type][1])).css('text-align', 'right'))
								.append($('<td>').text((100 * parseInt(data.types[type][1]) / parseInt(data.totalnum)).toFixed(2) + '%').css('text-align', 'right'))
								.append($('<td>').css('width', '100px').append($('<div>&nbsp;</div>').css({ 'overflow': 'hidden', 'width': (100 * parseInt(data.types[type][1]) / parseInt(data.totalnum)) + '%', 'background-color': '#00CCFF' })))
								
								.appendTo(typesBody);
						}
						$('#Types tfoot td:eq(1)').text(FormatBytes(typesTotals[0]) + ' (' + AddCommas(typesTotals[0]) + ')');
						$('#Types tfoot td:eq(2)').text(AddCommas(typesTotals[1]));
						
						sizesBody.empty();
						var sizesTotals = [0,0];
						for (var size in data.sizes) {
							sizesTotals[0] += parseInt(data.sizes[size][0]);
							sizesTotals[1] += parseInt(data.sizes[size][1]);
							
							$('<tr>')
								.append($('<td>').text(sizeGroups[parseInt(size)]).data('sortvalue', parseInt(size)))
								
								.append($('<td>').text(FormatBytes(data.sizes[size][0])).data('sortvalue', parseInt(data.sizes[size][0])).css('text-align', 'right'))
								.append($('<td>').text((100 * parseInt(data.sizes[size][0]) / parseInt(data.totalbytes)).toFixed(2) + '%').css('text-align', 'right'))
								.append($('<td>').css('width', '100px').append($('<div>&nbsp;</div>').css({ 'overflow': 'hidden', 'width': (100 * parseInt(data.sizes[size][0]) / parseInt(data.totalbytes)) + '%', 'background-color': '#00CCFF' })))
								
								.append($('<td>').text(data.sizes[size][1]).data('sortvalue', parseInt(data.sizes[size][1])).css('text-align', 'right'))
								.append($('<td>').text((100 * parseInt(data.sizes[size][1]) / parseInt(data.totalnum)).toFixed(2) + '%').css('text-align', 'right'))
								.append($('<td>').css('width', '100px').append($('<div>&nbsp;</div>').css({ 'overflow': 'hidden', 'width': (100 * parseInt(data.sizes[size][1]) / parseInt(data.totalnum)) + '%', 'background-color': '#00CCFF' })))
								
								.appendTo(sizesBody);
						}
						$('#Sizes tfoot td:eq(1)').text(FormatBytes(sizesTotals[0]) + ' (' + AddCommas(sizesTotals[0]) + ')');
						$('#Sizes tfoot td:eq(2)').text(AddCommas(sizesTotals[1]));
						
						sorter(sizesBody, sizesSortCol, sizesSortRev);
					}
				});
			}
		});
	});
</script>
</head>
<body>
	
<h1 id="Path"></h1>

<table border="1" cellspacing="0" cellpadding="4">
	<tbody>
		<tr>
			<td colspan="2" align="center"><b>This Directory</b></td>
		</tr>
		<tr>
			<th>Files:</th>
			<td id="Num"></td>
		</tr>
		<tr>
			<th>Bytes:</th>
			<td id="Bytes"></td>
		</tr>
		<tr>
			<td colspan="2" align="center"><b>Including Sub Directories</b></td>
		</tr>
		<tr>
			<th>Files:</th>
			<td id="TotalNum"></td>
		</tr>
		<tr>
			<th>Bytes:</th>
			<td id="TotalBytes"></td>
		</tr>
	</tbody>
</table>

<h2>Sub Directories:</h2>

<table id="SubDirs" border="1" cellspacing="0" cellpadding="4">
	<thead>
		<tr>
			<th>Name</th>
			<th colspan="3">Total Bytes</th>
			<th colspan="3">Count</th>
		</tr>
	</thead>
	<tfoot>
		<td>Totals</td>
		<td colspan="3"></td>
		<td colspan="3"></td>
	</tfoot>
	<tbody>
		
	</tbody>
</table>

<h2>Last Modified:</h2>

<table id="Modified" border="1" cellspacing="0" cellpadding="4">
	<thead>
		<tr>
			<th>Age</th>
			<th colspan="3">Total Bytes</th>
			<th colspan="3">Count</th>
		</tr>
	</thead>
	<tfoot>
		<td>Totals</td>
		<td colspan="3"></td>
		<td colspan="3"></td>
	</tfoot>
	<tbody>
		
	</tbody>
</table>

<h2>File Sizes:</h2>

<table id="Sizes" border="1" cellspacing="0" cellpadding="4">
	<thead>
		<tr>
			<th>Range</th>
			<th colspan="3">Total Bytes</th>
			<th colspan="3">Count</th>
		</tr>
	</thead>
	<tfoot>
		<td>Totals</td>
		<td colspan="3"></td>
		<td colspan="3"></td>
	</tfoot>
	<tbody>
		
	</tbody>
</table>

<h2>File Types:</h2>

<table id="Types" border="1" cellspacing="0" cellpadding="4">
	<thead>
		<tr>
			<th>Type</th>
			<th colspan="3">Total Bytes</th>
			<th colspan="3">Count</th>
		</tr>
	</thead>
	<tfoot>
		<td>Totals</td>
		<td colspan="3"></td>
		<td colspan="3"></td>
	</tfoot>
	<tbody>
		
	</tbody>
</table>

<h2>Files:</h2>

<table id="Files" border="1" cellspacing="0" cellpadding="4">
	<thead>
		<tr>
			<th>Name</th>
			<th>Type</th>
			<th>Size</th>
			<th>Modified</th>
		</tr>
	</thead>
	<tbody>
		
	</tbody>
</table>

</body>
</html>